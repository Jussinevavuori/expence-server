# Migration `20210314125235-budgets`

This migration has been generated by Jussi at 3/14/2021, 2:52:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."BudgetType" AS ENUM ('INCOME', 'EXPENSE')

CREATE TABLE "budgets" (
    "id" TEXT NOT NULL,
    "uid" TEXT NOT NULL,
    "label" TEXT,
    "type" "BudgetType" NOT NULL,
    "integer_amount" INTEGER NOT NULL,
    "created_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updated_at" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("id")
)

CREATE TABLE "_BudgetToCategory" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "_BudgetToCategory_AB_unique" ON "_BudgetToCategory"("A", "B")

CREATE INDEX "_BudgetToCategory_B_index" ON "_BudgetToCategory"("B")

ALTER TABLE "budgets" ADD FOREIGN KEY("uid")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_BudgetToCategory" ADD FOREIGN KEY("A")REFERENCES "budgets"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_BudgetToCategory" ADD FOREIGN KEY("B")REFERENCES "categories"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20210314125118-reset..20210314125235-budgets
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource postgresql {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Transaction {
   id            String   @id @default(uuid())
@@ -16,10 +16,10 @@
   time          DateTime
   createdAt     DateTime @default(now()) @map("created_at")
   updatedAt     DateTime @default(now()) @updatedAt @map("updated_at")
-  user     User     @relation(fields: [uid], references: [id])
-  category Category @relation(fields: [categoryId], references: [id])
+  User     User     @relation(fields: [uid], references: [id])
+  Category Category @relation(fields: [categoryId], references: [id])
   @@map(name: "transactions")
 }
@@ -38,25 +38,48 @@
   createdAt          DateTime @default(now()) @map("created_at")
   updatedAt          DateTime @default(now()) @updatedAt @map("updated_at")
   stripeCustomerId   String?  @map("stripe_customer_id")
-  transactions Transaction[]
-  categories   Category[]
+  Transactions Transaction[]
+  Categories   Category[]
+  Budgets      Budget[]
   @@map(name: "users")
 }
+model Budget {
+  id            String     @id @default(uuid())
+  uid           String
+  label         String?
+  type          BudgetType
+  integerAmount Int        @map("integer_amount")
+  createdAt     DateTime   @default(now()) @map("created_at")
+  updatedAt     DateTime   @default(now()) @updatedAt @map("updated_at")
+
+  Categories Category[]
+
+  User User @relation(fields: [uid], references: [id])
+
+  @@map(name: "budgets")
+}
+
+enum BudgetType {
+  INCOME
+  EXPENSE
+}
+
 model Category {
   id        String   @id @default(uuid())
   uid       String
   value     String
   icon      String?
   createdAt DateTime @default(now()) @map("created_at")
   updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
+  Transactions Transaction[]
+  Budgets      Budget[]
+
   user User @relation(fields: [uid], references: [id])
-  Transaction Transaction[]
-
   @@unique([uid, value], name: "unique_uid_value")
   @@map(name: "categories")
 }
```


